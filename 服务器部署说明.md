# 服务器部署快速指南

## 方式一：一键自动部署（推荐）

### 步骤说明

**第一步：在本地电脑执行**（上传项目到服务器）

```bash
# 在本地电脑的终端执行，将项目上传到服务器
# 注意：将 your-server-ip 替换为你的服务器IP地址
scp -r goseckill-12-01 root@43.128.79.42:/opt/
```

**第二步：在服务器上执行**（SSH登录后运行部署脚本）

```bash
# 1. SSH 登录到服务器（在本地电脑执行）
ssh root@43.128.79.42

# 2. 登录成功后，在服务器的终端执行以下命令
cd /opt/goseckill-12-01
sudo bash deploy.sh
```

### 完整流程示例

```bash
# ===== 在本地电脑执行 =====
# 1. 上传项目（在本地终端）
scp -r goseckill-12-01 root@192.168.1.100:/opt/

# 2. SSH 登录服务器（在本地终端）
ssh root@192.168.1.100

# ===== 登录后，在服务器上执行 =====
# 3. 进入项目目录
cd /opt/goseckill-12-01

# 4. 运行部署脚本
sudo bash deploy.sh
```

部署脚本会自动：
- 安装 Go 环境
- 安装并配置 MySQL、Redis、RabbitMQ
- 编译项目
- 创建 systemd 服务
- 启动所有服务

## 方式二：手动部署

### 1. 准备环境

```bash
# 安装 Go
wget https://go.dev/dl/go1.22.0.linux-amd64.tar.gz
sudo tar -C /usr/local -xzf go1.22.0.linux-amd64.tar.gz
echo 'export PATH=$PATH:/usr/local/go/bin' >> ~/.bashrc
source ~/.bashrc

# 安装依赖服务
sudo apt update
sudo apt install -y mysql-server redis-server rabbitmq-server
```

### 2. 配置数据库

```bash
sudo mysql -u root -p << EOF
CREATE DATABASE goseckill CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE USER 'goseckill'@'localhost' IDENTIFIED BY 'goseckill123';
GRANT ALL PRIVILEGES ON goseckill.* TO 'goseckill'@'localhost';
FLUSH PRIVILEGES;
EOF
```

### 3. 启动依赖服务

```bash
sudo systemctl start mysql
sudo systemctl start redis-server
sudo systemctl start rabbitmq-server
sudo systemctl enable mysql redis-server rabbitmq-server
```

### 4. 部署项目

```bash
# 上传项目到服务器后
cd /opt/goseckill-12-01
go mod download
go build -o bin/web ./cmd/web
go build -o bin/admin ./cmd/admin
go build -o bin/seckill-worker ./cmd/seckill-worker
```

### 5. 启动服务

```bash
# 方式1: 直接运行（测试用）
./bin/web &
./bin/admin &
./bin/seckill-worker &

# 方式2: 使用 systemd（生产环境推荐）
# 参考 部署指南.md 中的 systemd 配置
```

## 验证部署

```bash
# 检查服务状态
sudo systemctl status goseckill-web
sudo systemctl status goseckill-admin
sudo systemctl status goseckill-worker

# 测试接口
curl http://localhost:8080/api/health

# 查看日志
sudo journalctl -u goseckill-web -f
```

## 访问地址

- **Web 前端**: `http://服务器IP:8080`
- **Admin 后台**: `http://服务器IP:8081`

## 常用命令

```bash
# 启动服务
sudo systemctl start goseckill-web
sudo systemctl start goseckill-admin
sudo systemctl start goseckill-worker

# 停止服务
sudo systemctl stop goseckill-web
sudo systemctl stop goseckill-admin
sudo systemctl stop goseckill-worker

# 重启服务
sudo systemctl restart goseckill-web

# 查看日志
sudo journalctl -u goseckill-web -f
sudo journalctl -u goseckill-admin -f
sudo journalctl -u goseckill-worker -f

# 查看服务状态
sudo systemctl status goseckill-web
```

## 防火墙配置

```bash
# Ubuntu/Debian
sudo ufw allow 8080/tcp
sudo ufw allow 8081/tcp

# CentOS/RHEL
sudo firewall-cmd --permanent --add-port=8080/tcp
sudo firewall-cmd --permanent --add-port=8081/tcp
sudo firewall-cmd --reload
```

## 更新代码

```bash
cd /opt/goseckill-12-01
# 拉取最新代码或上传新文件
go build -o bin/web ./cmd/web
go build -o bin/admin ./cmd/admin
go build -o bin/seckill-worker ./cmd/seckill-worker
sudo systemctl restart goseckill-web
sudo systemctl restart goseckill-admin
sudo systemctl restart goseckill-worker
```

## 详细说明

更多详细信息请查看 `部署指南.md` 文件。

## 注意事项

1. **默认配置**：项目使用硬编码的默认配置，如需修改请编辑 `internal/config/config.go`
2. **数据库密码**：默认密码为 `goseckill123`，生产环境请修改
3. **端口**：Web 服务 8080，Admin 服务 8081，确保防火墙开放
4. **资源要求**：建议至少 2GB 内存，10GB 磁盘空间
