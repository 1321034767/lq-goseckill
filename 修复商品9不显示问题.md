# 修复商品9不显示问题

## 问题描述

首页中商品9（ID=9）不显示，原因是商品列表查询逻辑只查询 `status = 1`（正常状态）的商品，而商品9可能处于 `status = 2`（秒杀中）状态，即使活动已结束，也不会被查询出来。

## 问题原因

1. **商品列表查询过滤过严**：
   - `ListOnline()` 方法只查询 `status = 1` 的商品
   - `ListByCategory()` 方法也只查询 `status = 1` 的商品
   - 秒杀中的商品（`status = 2`）应该也在首页显示

2. **活动结束恢复逻辑的时机问题**：
   - 活动结束时的商品状态恢复是在查询之后进行的
   - 如果商品状态是2，它在数据库查询阶段就被过滤掉了
   - 即使后续恢复了状态，也不会出现在列表中

## 解决方案

### 1. 修改商品列表查询逻辑

**修改文件**: `internal/repository/mysql/product_repo.go`

- `ListOnline()`: 查询状态为1（正常）或2（秒杀中）的商品
- `ListByCategory()`: 同样查询状态为1或2的商品

```go
// 修改前
Where("status = ?", 1)

// 修改后
Where("status IN ?", []int{1, 2})
```

### 2. 增强商品列表API的处理逻辑

**修改文件**: `internal/server/router.go`

- 在返回商品列表前，重新查询商品状态（因为活动可能已过期）
- 如果商品状态被恢复为正常，使用更新后的商品信息
- 过滤掉状态为0（下线）的商品

## 修改的文件

1. `internal/repository/mysql/product_repo.go`
   - `ListOnline()`: 包含秒杀中的商品
   - `ListByCategory()`: 包含秒杀中的商品

2. `internal/server/router.go`
   - 商品列表API: 增强状态检查和恢复逻辑

## 功能改进

1. **秒杀商品正常显示**: 秒杀中的商品也会在首页显示
2. **自动状态恢复**: 活动结束后，商品状态自动恢复，并立即在列表中反映
3. **状态一致性**: 确保显示的商品状态与数据库一致

## 测试方法

1. **检查商品9的状态**:
   ```sql
   SELECT id, name, status FROM products WHERE id = 9;
   ```

2. **如果商品9状态是2（秒杀中）**:
   - 刷新首页，商品9应该现在可以显示了
   - 如果活动已结束，商品9的状态会自动恢复为1

3. **如果商品9状态是0（下线）**:
   - 需要在后台管理界面将商品状态改为1（正常）

## 注意事项

- 商品状态说明：
  - `0`: 下线（不显示）
  - `1`: 正常（显示）
  - `2`: 秒杀中（显示）

- 如果商品9仍然不显示，请检查：
  1. 商品是否存在（`SELECT * FROM products WHERE id = 9;`）
  2. 商品状态是否为0（下线）
  3. 是否有其他过滤条件
