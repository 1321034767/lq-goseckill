# 限购功能实现说明

## 已完成的功能

### 1. 数据模型修改
- ✅ 在 `SeckillActivity` 模型中添加了 `LimitPerUser` 字段（每人限购数量）
- ✅ 默认值为1，表示每个用户最多可购买1件

### 2. 后台管理界面
- ✅ 添加了"每人限购数量"输入框
- ✅ 时间输入框支持精确到秒（添加了 `step="1"` 属性）
- ✅ 活动列表显示限购数量列
- ✅ 活动详情显示限购数量信息

### 3. 前端显示
- ✅ 商品详情页添加了限购数量显示区域（需要进一步实现API获取）

### 4. API接口
- ✅ 创建活动接口支持 `limit_per_user` 参数
- ✅ 更新活动接口支持 `limit_per_user` 参数
- ✅ 时间解析支持精确到秒的格式（`2006-01-02T15:04:05`）

## 修改的文件

1. **数据模型**
   - `internal/datamodels/seckill_activity/seckill_activity.go` - 添加 `LimitPerUser` 字段

2. **服务层**
   - `internal/service/seckill_activity_service.go` - 添加 `LimitPerUser` 字段到请求结构体

3. **路由层**
   - `internal/server/admin_router.go` - 修改创建/更新活动接口，支持限购数量和时间精确到秒

4. **前端界面**
   - `web/admin/index.html` - 添加限购数量输入框和时间精确到秒
   - `web/admin/assets/app.js` - 修改表单处理和显示逻辑
   - `web/views/product/view.html` - 添加限购数量显示区域

## 测试方法

### 1. 运行测试程序

```bash
cd /root/internship-preparation/goseckill-12-01
go run ./cmd/test-limit-per-user/main.go
```

### 2. 手动测试步骤

1. **启动服务**
   ```bash
   go run ./cmd/web &
   go run ./cmd/admin &
   go run ./cmd/seckill-worker &
   ```

2. **访问后台管理界面**
   - 打开浏览器访问 `http://localhost:8081`
   - 点击"秒杀活动管理"

3. **创建活动**
   - 点击"新建活动"
   - 填写活动信息：
     - 活动名称：测试活动
     - 开始时间：选择时间（注意可以精确到秒）
     - 结束时间：选择时间（注意可以精确到秒）
     - 折扣：0.8
     - **每人限购数量：2**（重要）
   - 选择商品
   - 点击"保存活动"

4. **验证功能**
   - 查看活动列表，确认"限购数量"列显示正确
   - 点击"查看"按钮，确认活动详情显示限购数量
   - 检查时间格式是否包含秒

## 注意事项

1. **时间格式**：前端使用 `datetime-local` 输入框，支持精确到秒
2. **限购数量**：默认值为1，最小值为1
3. **秒杀逻辑**：目前限购数量已保存到数据库，但秒杀时的限购检查逻辑需要进一步实现（需要查询用户已购买数量）

## 待完善功能

- [ ] 实现秒杀时的限购数量检查逻辑
- [ ] 添加API接口获取商品的限购数量（用于前端显示）
- [ ] 在前端商品详情页显示限购数量（需要API支持）

## 测试结果

运行测试程序后，应该看到：
- ✅ 活动创建成功
- ✅ 限购数量设置为2
- ✅ 时间格式包含秒
